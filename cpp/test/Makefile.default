EIGEN_INC=../external/eigen
BOOST_INC=../external
GCC_LIB=/usr/local/lib/gcc/8/
MKL_INC=${MKLROOT}/include
MKL_LIB=${MKLROOT}/lib
NO_AS_NEEDED=
#MKL_LIB=${MKLROOT}/lib/intel64
#NO_AS_NEEDED=-Wl,--no-as-needed
SIMD=4

#CXX=icpc
#CXXFLAGS=-xHost -O3 -g -DDATA_WIDTH=${SIMD} -qopenmp -std=c++17 -w2 -I${MKL_INC} -I${EIGEN_INC} -I${BOOST_INC} -DMKL_INT=long
#LDLIBSOPTIONS=-qopenmp -L${MKL_LIB} -Wl,-rpath,'${MKL_LIB}' -lmkl_core -lmkl_intel_thread -lmkl_intel_ilp64

CXX=g++
CXXFLAGS=-fopenmp -O3 -ffast-math -g -std=c++17 -DDATA_WIDTH=${SIMD} -Wall -I${MKL_INC} -I${EIGEN_INC} -I${BOOST_INC} -DMKL_INT=long
LDLIBSOPTIONS=-fopenmp -L${MKL_LIB} -Wl,-rpath,'${MKL_LIB}' ${NO_AS_NEEDED} -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -liomp5 -L${GCC_LIB} -Wl,-rpath,'${GCC_LIB}' -lstdc++fs

#########################DO NOT MODIFY BELOW THIS LINE##########################
################################################################################

DIRECTORY = $(wildcard */)

TEST_CPP = $(shell find . -name \*.cpp -print)
TEST_H = $(shell find . -name \*.h -print)
EXECUTABLES = $(TEST_CPP:./%.cpp=%.exe)

COMPILELINE=${CXX} ${CXXFLAGS} -I../include -c

OBJECTDIR=build

all: ${EXECUTABLES} ${TEST_CPP} ${TEST_H}

%.o: %.cpp
	rm -f "$@.d"
	${COMPILELINE} -MMD -MP -MF "$@.d" -o $@ $<

%.exe: %.o
	$(CXX) -o $@ $< ${LDLIBSOPTIONS} -L../lib -lbesthea

clean:
	$(foreach sd,${DIRECTORY}, rm -f ${sd}*.o.d;)
	$(foreach sd,${DIRECTORY}, rm -f ${sd}*.o;)

distclean: clean
	$(foreach sd,${DIRECTORY}, rm -f ${sd}*.exe)

help:
	@echo "This makefile supports the following targets:"
	@echo "    all  (default target, builds static library)"
	@echo "    clean"
	@echo "    distclean"
	@echo "    help"
