EIGEN_INC=../external/eigen
SIMD=4

#CXX=icpc
#CXXFLAGS=-xHost -O3 -g -DDATA_WIDTH=${SIMD} -qopenmp -std=c++17 -w2 -I${MKLROOT}/include -I${EIGEN_INC}
#LDLIBSOPTIONS=-qopenmp -L${MKLROOT}/lib/intel64 -Wl,-rpath,'${MKLROOT}/lib/intel64' -lmkl_core -lmkl_intel_thread -lmkl_intel_ilp64

#CXX=g++
#CXXFLAGS=-fopenmp -O3 -g -std=c++17 -DDATA_WIDTH=${SIMD} -Wall -I${MKLROOT}/include -I${EIGEN_INC}
#LDLIBSOPTIONS=-fopenmp -L${MKLROOT}/lib -Wl,-rpath,'${MKLROOT}/lib' -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -liomp5

CXX=g++
CXXFLAGS=-fopenmp -O3 -g -std=c++17 -DDATA_WIDTH=${SIMD} -Wall -I${MKLROOT}/include -I${EIGEN_INC}
LDLIBSOPTIONS=-fopenmp -L${MKLROOT}/lib/intel64 -Wl,-rpath,'${MKLROOT}/lib/intel64' -Wl,--no-as-needed -lmkl_intel_ilp64 -lmkl_intel_thread -lmkl_core -liomp5

#########################DO NOT MODIFY BELOW THIS LINE##########################
################################################################################

DIRECTORY = $(wildcard */)

TEST_CPP = $(shell find . -name \*.cpp -print)
TEST_H = $(shell find . -name \*.h -print)
EXECUTABLES = $(TEST_CPP:./%.cpp=%.exe)

COMPILELINE=${CXX} ${CXXFLAGS} -I../include -c

OBJECTDIR=build

all: ${EXECUTABLES} ${TEST_CPP} ${TEST_H}

%.o: %.cpp
	rm -f "$@.d"
	${COMPILELINE} -MMD -MP -MF "$@.d" -o $@ $<

%.exe: %.o
	$(CXX) -o $@ $< ${LDLIBSOPTIONS} -L../lib -lbesthea

clean:
	$(foreach sd,${DIRECTORY}, rm -f ${sd}*.o.d;)
	$(foreach sd,${DIRECTORY}, rm -f ${sd}*.o;)

distclean: clean
	$(foreach sd,${DIRECTORY}, rm -f ${sd}*.exe)

help:
	@echo "This makefile supports the following targets:"
	@echo "    all  (default target, builds static library)"
	@echo "    clean"
	@echo "    distclean"
	@echo "    help"
