\documentclass[a4paper,11pt]{article}

\input{scripts.tex}

\title{\sffamily\bfseries Integration schemes \\ for the heat boundary integral equations}
\author{Jan Zapletal\\\texttt{jan.zapletal@vsb.cz}}
\date{\today}

\begin{document}

\pagenumbering{roman} 

\maketitle
\thispagestyle{empty}
\vfill
\tableofcontents
\thispagestyle{empty}
\vfill
\newpage

\pagestyle{plain}
\setcounter{page}{1}
\pagenumbering{arabic}

\section{Heat equation}

%\nocite{DohEtAl2018,DohZapOfMer2019}

For a bounded Lipschitz domain $\Omega \subset \R^3$ we aim to solve the heat equation \cite{Mes2014,MesSchTau2014,MesSchTau2015}
\begin{equation}
  \label{eq:heat_eq}
  \frac{\partial u}{\partial t}(\vx,t) - \alpha \upDelta u(\vx,t) = 0 \quad\text{for } (\vx,t) \in \Omega \times (0,T) =: Q
\end{equation}
with $\alpha \geq 0$, the initial condition
\begin{equation*}
  u(\vx,0) = u_0(\vx) \quad\text{for }\vx \in \Omega
\end{equation*}
and a Dirichlet or Neumann boundary condition, i.e.
\begin{equation*}
  u(\vx,t) = g(\vx,t) \quad\text{for }(\vx,t) \in \partial\Omega \times (0,T) =: \Sigma
\end{equation*}
or
\begin{equation*}
  \alpha\frac{\partial u}{\partial \vn}(\vx,t) = h(\vx,t) \quad\text{for }(\vx,t) \in \partial\Omega \times (0,T),
\end{equation*}
respectively.

The solution to \eqref{eq:heat_eq} is given by the representation formula
\begin{equation}
  \label{eq:repr}
  u(\vx,t) = \widetilde{M}_0 u_0(\vx,t) + \widetilde V \alpha\frac{\partial u}{\partial \vn}(\vx,t) - Wu(\vx,t)
\end{equation}
with the initial potential
\begin{equation*}
  \widetilde{M}_0 u_0(\vx,t) := \int_\Omega G_\alpha(\vx-\vy,t) u_0(\vy) \,\dif\vy,
\end{equation*}
the single-layer potential
\begin{equation*}
  \widetilde V \alpha\frac{\partial u}{\partial \vn} (\vx,t) := \int_0^t \int_{\partial\Omega} G_\alpha(\vx-\vy,t-\tau) \alpha\frac{\partial u}{\partial \vn} (\vy,\tau) \,\dif\vs_\vy \,\dif\tau,
\end{equation*}
the double-layer potential
\begin{equation*}
  W u (\vx,t) := \int_0^t \int_{\partial\Omega} \alpha\frac{\partial G_\alpha}{\partial \vn_\vy}(\vx-\vy,t-\tau) u(\vy,\tau) \,\dif\vs_\vy \,\dif\tau,
\end{equation*}
and the fundamental solution to the heat equation
\begin{equation*}
  G_\alpha(\vx-\vy,t-\tau) :=
  \begin{cases}
  \displaystyle
  \frac{1}{(4\pi\alpha(t-\tau))^{3/2}}\exp\bigg( -\frac{\|\vx-\vy\|^2}{4\alpha(t-\tau)} \bigg) & \text{for } t > \tau, \\
  0 & \text{otherwise.}
  \end{cases}
\end{equation*}
Differentiating we obtain
\begin{equation*}
  \alpha\frac{\partial G_\alpha}{\partial \vn_\vy}(\vx-\vy,t-\tau) :=
  \begin{cases}
  \displaystyle
  \frac{(\vx-\vy)\cdot \vn_\vy}{16(\pi\alpha)^{3/2}(t-\tau)^{5/2}}\exp\bigg( -\frac{\|\vx-\vy\|^2}{4\alpha(t-\tau)} \bigg) & \text{for } t > \tau, \\
  0 & \text{otherwise.}
  \end{cases}
\end{equation*}  

%\begin{remark}
%  \label{rem:scaling}
%  It can be easily verified that there holds the scaling relation
%  \begin{equation}
%  \label{eq:G_scaling}
%    G_\alpha(\vx-\vy,\beta(t-\tau)) = \frac{1}{(\alpha\beta)^{3/2}} G_1\bigg( \frac{\vx-\vy}{\sqrt{\alpha\beta}}, t-\tau \bigg).
%  \end{equation}
%\end{remark}

To obtain the Cauchy data we apply the Dirichlet and Neumann trace operators to the representation formula \eqref{eq:repr} to obtain the boundary integral equations \cite{Cos1990,Cos2004,Noo1988,DohNiiSte2018}
\begin{align*}
  Vw(\vx,t) &= \bigg(\frac{1}{2} I + K \bigg) u(\vx,t) - M_0 u_0(\vx,t) &&\text{for } (\vx,t) \in \Sigma, \\
  Du(\vx,t) &= \bigg(\frac{1}{2} I - K^\ast \bigg) w(\vx,t) - M_1 u_0(\vx,t) &&\text{for } (\vx,t) \in \Sigma,
\end{align*}
respectively, with $w := \alpha\partial u/\partial \vn $. The boundary integral operators $V$, $K$, $M_0$, $D$, $K^\ast$, and $M_1$ denote the compositions of the potentials with the respective traces and for sufficiently regular functions admit the representations
\begin{align*}
  V &\colon X^\ast \to X, &Vw(\vx,t) &= \int_0^t \int_{\partial\Omega} G_\alpha(\vx-\vy,t-\tau) w(\vy,\tau) \,\dif\vs_\vy \,\dif\tau, \\
  K &\colon X \to X, &Ku(\vx,t) &= \int_0^t \int_{\partial\Omega} \alpha\frac{\partial G_\alpha}{\partial \vn_\vy}(\vx-\vy,t-\tau) u(\vy,\tau) \,\dif\vs_\vy \,\dif\tau, \\
  M_0 &\colon Y \to X, &M_0 u_0(\vx,t) &= \int_\Omega G_\alpha(\vx-\vy,t) u_0(\vy) \,\dif\vy, \\
  D &\colon X \to X^\ast, &Du(\vx,t) &= -\alpha \frac{\partial}{\partial \vn_\vx} \int_0^t \int_{\partial\Omega} \alpha\frac{\partial G_\alpha}{\partial \vn_\vy}(\vx-\vy,t-\tau) u(\vy,\tau) \,\dif\vs_\vy \,\dif\tau, \\
  K^\ast &\colon X^\ast \to X^\ast, &K^\ast w(\vx,t) &= \int_0^t \int_{\partial\Omega} \alpha\frac{\partial G_\alpha}{\partial \vn_\vx}(\vx-\vy,t-\tau) w(\vy,\tau) \,\dif\vs_\vy \,\dif\tau, \\
  M_1 &\colon Y \to X^\ast, &M_1 u_0(\vx,t) &= \int_\Omega \alpha\frac{\partial G_\alpha}{\partial \vn_\vx}(\vx-\vy,t) u_0(\vy) \,\dif\vy.
\end{align*}

Choosing proper functional spaces $X$ (defining its dual $X^\ast$) and $Y$, the above boundary integral equations are equivalent to the variational formulations
\begin{align}
  \label{eq:v_form}
  \langle Vw, q \rangle_\Sigma &= \bigg\langle \bigg( \frac{1}{2}I + K \bigg) u, q \bigg\rangle_\Sigma - \langle M_0 u_0, q \rangle_\Sigma &&\text{for all } q \in X^\ast,\\
  \notag
  \langle Du, r \rangle_\Sigma &= \bigg\langle \bigg( \frac{1}{2}I - K^\ast \bigg) w, r \bigg\rangle_\Sigma - \langle M_1 u_0, r \rangle_\Sigma &&\text{for all } r \in X
\end{align}
with the duality pairing between $X^\ast$ and $X$
\begin{equation*}
  \langle v, w \rangle_\Sigma := \int_0^T \int_{\partial\Omega} v(\vx,t) w(\vx,t) \,\dif\vs_\vx \,\dif t.
\end{equation*}
For the duality pairing with the hypersingular operator we have an alternative representation removing the non-integrable singularity, namely
\begin{equation}
\label{eq:D_bil}
\begin{aligned}
  \langle Du, r \rangle_\Sigma &= \alpha^2 \int_0^T \int_{\partial\Omega} \curl_{\partial\Omega} r(\vx,t) \cdot \bigg( \int_0^t \int_{\partial\Omega} \curl_{\partial\Omega} u(\vy,\tau) G_\alpha(\vx-\vy,t-\tau) \,\dif\vs_\vy \,\dif\tau \bigg) \,\dif\vs_\vx \,\dif t \\
  &- \alpha \int_0^T \int_{\partial\Omega} r(\vx,t) \vn(\vx) \cdot \bigg( \int_0^t \int_{\partial\Omega} \vn(\vy) u(\vy,t) \frac{\partial G_\alpha}{\partial \tau}(\vx-\vy,t-\tau) \,\dif\vs_\vy \,\dif\tau \bigg) \,\dif\vs_\vx \,\dif t.
\end{aligned}
\end{equation}

\section{Boundary element method}

We consider a tensor product space-time discretization $\Sigma_h$ of $\Sigma$, i.e for a given uniform decomposition of the time interval
\begin{equation*}
  \overline{(0,T)} = \bigcup_{i=1}^{E_t} \overline{(t_{i-1}, t_i)} = \bigcup_{i=1}^{E_t} \overline{((i-1)h_t, i h_t)}
\end{equation*}
and the discretization of $\Gamma_h$ approximating $\Gamma := \partial\Omega$,
\begin{equation*}
  \Gamma_h = \bigcup_{j=1}^{E_\vx} \overline{\gamma_j}
\end{equation*}
with $\gamma_j$ denoting planar triangular elements, we define
\begin{equation*}
  \overline{\Sigma_h} := \bigcup_{k=1}^{E_t E_{\vx}} \overline{\sigma_k} = \bigcup_{i=1}^{E_t} \bigcup_{j=1}^{E_\vx} \overline{(t_{i-1}, t_i)} \times \overline{\gamma_j}.
\end{equation*}
The basis functions of the approximating spaces $X_h^{0,1} \subset X$ and $X_h^{0,0} \subset X^\ast$ are defined accordingly, i.e. the spatial and temporal contributions can be separated as 
\begin{equation*}
  \varphi_{t\vx,k}(\vx,t) = \varphi_{t,i} (t) \varphi_{\vx,j} (\vx) =: \varphi_{t\vx,i,j}(\vx,t). 
\end{equation*}
We thus define the space 
\begin{equation*}
  X_h^{0,0} := \vspan (\varphi^{0,0}_{t\vx,k})_{k=1}^{E_t E_{\vx}} = \vspan ((\varphi^0_{t,i}\varphi^0_{\vx,j})_{j=1}^{E_{\vx}})_{i=1}^{E_t}
\end{equation*}
of functions piecewise constant both in space and time and the space  
\begin{equation*}
  X_h^{0,1} := \vspan (\varphi^{0,1}_{t\vx,k})_{k=1}^{E_t N_\vx} = \vspan ((\varphi^0_{t,i}\varphi^1_{\vx,j})_{j=1}^{N_{\vx}})_{i=1}^{E_t}
\end{equation*} 
of functions globally continuous and piecewise linear in space and piecewise constant in time. Here we denote by $N_\vx$ the number of nodes of the triangular mesh $\Gamma_h$.

\subsection{Single-layer operator}

Plugging the approximation
\begin{equation*}
 w \approx w_h := \sum_{k=1}^{E_t E_\vx} w_k \varphi^{0,0}_{t\vx,k} = \sum_{i=1}^{E_t} \sum_{j=1}^{E_\vx} w_{i,j} \varphi^0_{t,i} \varphi^0_{\vx,j}
\end{equation*}
into the left-hand side of \eqref{eq:v_form} and testing with
\begin{equation*}
  q := \varphi^0_{t,k} \varphi^0_{\vx,\ell}
\end{equation*}
we obtain
\begin{align*}
  \langle &Vw_h, q \rangle_\Sigma \\
  &= \int_0^T \int_{\partial\Omega} \varphi^0_{t,k}(t) \varphi^0_{\vx,\ell}(\vx) \int_0^t \int_{\partial\Omega} G_\alpha(\vx-\vy,t-\tau) \sum_{i=1}^{E_t} \sum_{j=1}^{E_\vx} w_{i,j} \varphi^0_{t,i}(\tau) \varphi^0_{\vx,j}(\vy) \,\dif\vs_\vy \,\dif\tau \,\dif\vs_\vx \,\dif t \\
  &= \sum_{i=1}^{k-1} \sum_{j=1}^{E_\vx} w_{i,j} \int_{\gamma_\ell} \int_{\gamma_j} \int_{t_{k-1}}^{t_k} \int_{t_{i-1}}^{t_i} G_\alpha(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx \\
  &+ \sum_{j=1}^{E_\vx} w_{k,j} \int_{\gamma_\ell} \int_{\gamma_j} \int_{t_{k-1}}^{t_k} \int_{t_{k-1}}^{t} G_\alpha(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx.
\end{align*}
Since the fundamental solution only depends on the difference $t-\tau$, the double temporal integral only depends on the difference $d := k - i$. The duality pairing with all testing functions thus leads to the Toeplitz matrix vector product
\begin{equation}
\label{eq:V_mat}
  \matV_h \vw = 
  \begin{bmatrix}
    \matV_h^0 & 0 & \ldots & 0 \\
    \matV_h^1 & \ddots & \ddots & \vdots \\
    \vdots & \ddots & \ddots & 0 \\
    \matV_h^{E_t-1} & \dots & \matV_h^1 & \matV_h^0
  \end{bmatrix}
  \begin{bmatrix}
    \vw^0 \\[1mm]
    \vw^1 \\[1mm]
    \vdots \\[1mm]
    \vw^{E_t-1}
  \end{bmatrix}
\end{equation}
with 
\begin{equation}
\label{eq:V_blocks}
\begin{aligned}
  \matV_h^0[\ell,j] &:= \int_{\gamma_\ell} \int_{\gamma_j} \int_{0}^{t_1} \int_{0}^{t} G_\alpha(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx, \\
  \matV_h^d[\ell,j] &:= \int_{\gamma_\ell} \int_{\gamma_j} \int_{t_d}^{t_{d+1}} \int_{0}^{t_1} G_\alpha(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx
\end{aligned}
\end{equation}
for $d \in \{1,\ldots,E_t-1\}$ and $w^d_j := w_{d+1,j}$.

To set up $\matV_h$ we will use analytic integration in time and a regularized quadrature in space as used in stationary problems. Using $t_d = dh_t$ we thus have to evaluate
\begin{equation}
\label{eq:V_d}
  V^d(\vr) := 
  \begin{cases}
  \displaystyle
    \int_{0}^{h_t} \int_{0}^{t} G_\alpha(\vr,t-\tau) \,\dif\tau \,\dif t & \text{for } d = 0, \\[4mm]
  \displaystyle
    \int_{dh_t}^{(d+1)h_t} \int_{0}^{h_t} G_\alpha(\vr,t-\tau) \,\dif\tau \,\dif t & \text{for } d \in \{1,\ldots,E_t-1\}.
  \end{cases}
\end{equation}
Let us start with the latter case. Integrating with respect to $\tau$ leads to
\begin{equation*}
  V^d(\vr) = \int_{dh_t}^{(d+1)h_t} G^{\dif\tau}_\alpha(\vr,t-h_t) - G^{\dif\tau}_\alpha(\vr,t) \,\dif t
\end{equation*}
with
\begin{equation}
  \label{eq:G_dtau}
  G^{\dif\tau}_\alpha(\vr,\delta) = \frac{1}{4\pi \alpha \|\vr\|} \erf\bigg( \frac{\|\vr\|}{2\sqrt{\alpha\delta}} \bigg)
\end{equation}
and the error function
\begin{equation*}
  \erf(x) := \frac{2}{\sqrt{\pi}} \int_0^x e^{-t^2} \,\dif t.
\end{equation*}
Continuing in the integration we obtain
\begin{equation*}
  V^d(\vr) = 2G^{\dif\tau\dif t}_\alpha(\vr,d h_\tau) - G^{\dif\tau\dif t}_\alpha(\vr,(d+1)h_t) - G^{\dif\tau\dif t}_\alpha(\vr,(d-1)h_t)
\end{equation*}
with 
\begin{equation*}
  G^{\dif\tau\dif t}_\alpha(\vr,\delta) = \frac{1}{4\pi} \bigg[ \bigg( \frac{\|\vr\|}{2\alpha^2} + \frac{\delta}{\alpha \|\vr\|} \bigg) \erf\bigg( \frac{\|\vr\|}{2\sqrt{\alpha\delta}} \bigg) + \frac{\sqrt{\delta}}{\sqrt{\pi\alpha^3}}\exp\bigg( -\frac{\|\vr\|^2}{4\alpha\delta} \bigg) \bigg] \quad\text{for } \delta > 0.
\end{equation*}
For $\|\vr\| > 0$ we have to treat the case
\begin{equation*}
  \lim_{\delta \to 0+} G^{\dif\tau\dif t}_\alpha(\vr,\delta) = \frac{\|\vr\|}{8\pi\alpha^2}.
\end{equation*} 
Similarly, for well separated $t$ and $\tau$, i.e. for $\delta > 0$, we compute the limit
\begin{equation*}
  \lim_{\|\vr\|\to 0+} G^{\dif\tau\dif t}_\alpha(\vr,\delta) = \frac{\sqrt{\delta}}{2\sqrt{\pi^3\alpha^3}}.
\end{equation*}
Thus, if either the spatial or temporal variables are well separated, i.e. we integrate over disjoint triangles or time intervals, standard quadrature routines can be applied. For the near field, regularized quadrature techniques based on the Duffy transformation can be used \cite{SauSch2010,ManTau2019}. 

For $V^0(\vr)$ we obtain in a similar fashion
\begin{align*}
  V^0(\vr) &= \int_{0}^{t} G^{\dif \tau}_\alpha(\vr,0) - G^{\dif \tau}_\alpha(\vr, t) \,\dif t 
  =h_t G^{\dif\tau}_\alpha(\vr,0) - G^{\dif\tau\dif t}_\alpha(\vr,h_t) + G^{\dif\tau\dif t}_\alpha(\vr,0).
\end{align*}
Again, we have to consider the limiting case for $\|\vr\| > 0$,
\begin{equation}
  \label{eq:G_dtau_lim_d}
  \lim_{\delta \to 0+} G^{\dif\tau}_\alpha(\vr,\delta) = \frac{1}{4\pi\alpha\|\vr\|}.
\end{equation}

\subsection{Double-layer operator}

Plugging the approximation
\begin{equation*}
 u \approx u_h := \sum_{k=1}^{E_t N_\vx} u_k \varphi^{0,1}_{t\vx,k} = \sum_{i=1}^{E_t} \sum_{j=1}^{N_\vx} u_{i,j} \varphi^0_{t,i} \varphi^1_{\vx,j}
\end{equation*}
into \eqref{eq:D_bil} and testing with
\begin{equation*}
  q := \varphi^0_{t,k} \varphi^0_{\vx,\ell}
\end{equation*}
we obtain for $d=k-i$ that
\begin{align*}
  \langle Ku_h, q \rangle_\Sigma &= \sum_{i=1}^{k-1} \sum_{j=1}^{N_\vx} u_{i,j} \int_{\gamma_\ell} \int_{\partial\Omega} \varphi^1_{\vx,j}(\vy) \alpha \int_{t_d}^{t_{d+1}} \int_{0}^{t_1} \frac{\partial G_\alpha}{\partial \vn_\vy}(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx \\
  &+ \sum_{j=1}^{N_\vx} u_{k,j} \int_{\gamma_\ell} \int_{\partial\Omega} \varphi^1_{\vx,j}(\vy) \alpha \int_{0}^{t_1} \int_{0}^{t} \frac{\partial G_\alpha}{\partial \vn_\vy}(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx.
\end{align*}
We have to analytically evaluate the integrals
\begin{equation*}
  K^d(\vr) := 
  \begin{cases}
  \displaystyle
    \alpha \frac{\partial}{\partial \vn_\vy} \int_{0}^{h_t} \int_{0}^{t} G_\alpha(\vr,t-\tau) \,\dif\tau \,\dif t & \text{for } d = 0, \\[4mm]
  \displaystyle
    \alpha \frac{\partial}{\partial \vn_\vy} \int_{dh_t}^{(d+1)h_t} \int_{0}^{h_t} G_\alpha(\vr,t-\tau) \,\dif\tau \,\dif t & \text{for } d \in \{1,\ldots,E_t-1\}.
  \end{cases}
\end{equation*}
For $d > 0$ we thus obtain from the evaluation of \eqref{eq:V_d} that
\begin{align*}
  K^d(\vr) = \alpha \bigg( 2 \frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy} (\vr,dh_t) - \frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy}(\vr,(d+1)h_t) - \frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy}(\vr,(d-1)h_t) \bigg)
\end{align*}
Since $G^{\dif\tau\dif t}_\alpha$ only depends on the norm of its first argument, we can write 
\begin{equation}
  \label{eq:G_to_g}
  G^{\dif\tau\dif t}_\alpha(\vr,\delta) =: g^{\dif\tau\dif t}(\|\vr\|,\delta) \quad\text{with}\quad g^{\dif\tau\dif t}(\rho,\delta)\colon \R\times\R\to\R
\end{equation}
to obtain
\begin{equation}
\label{eq:dn_G_dt_dtau}
\begin{aligned}
  \frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy}(\vr,\delta) &= \frac{\partial g^{\dif\tau\dif t}}{\partial \rho}(\|\vr\|,\delta) \vn_\vy \cdot \nabla_\vy \|\vx-\vy\| 
  = - \frac{\partial g^{\dif\tau\dif t}}{\partial \rho}(\|\vr\|,\delta) \frac{ \vr \cdot \vn_\vy}{\| \vr\|}
\end{aligned}
\end{equation}
with
\begin{equation*}
  \frac{\partial g^{\dif\tau\dif t}}{\partial \rho}(\|\vr\|,\delta) =\frac{1}{4\pi} \bigg[  \bigg( \frac{1}{2\alpha^2} - \frac{\delta}{\alpha\|\vr\|^2} \bigg) \erf\bigg( \frac{\|\vr\|}{2\sqrt{\alpha\delta}} \bigg) + \frac{\sqrt{\delta}}{\|\vr\|\sqrt{\pi\alpha^3}} \exp \bigg( -\frac{\|\vr\|^2}{4\alpha\delta} \bigg) \bigg].
\end{equation*}
Collecting all intermediate steps brings us to
\begin{align*}
  \alpha\frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy}(\vr,\delta) = -\frac{1}{4\pi} \frac{ \vr \cdot \vn_\vy}{\|\vr\|}\bigg[  \bigg( \frac{1}{2\alpha} - \frac{\delta}{\|\vr\|^2} \bigg) \erf\bigg( \frac{\|\vr\|}{2\sqrt{\alpha\delta}} \bigg) + \frac{\sqrt{\delta}}{\|\vr\|\sqrt{\pi\alpha}} \exp \bigg( -\frac{\|\vr\|^2}{4\alpha\delta} \bigg) \bigg].
\end{align*}
For $\|\vr\|>0$ we have
\begin{equation*}
  \lim_{\delta \to 0_+}  \alpha\frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy}(\vr,\delta)  = -\frac{\vr \cdot \vn_\vy}{8 \pi\alpha \| \vr\|}.
\end{equation*}
Conversely, for $\delta > 0$ we have
\begin{equation*} 
  \lim_{\|\vr\| \to 0_+} \alpha\frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy}(\vr,\delta) = 0.
\end{equation*}
This follows by estimating 
\begin{equation*}
	\left| \frac{\partial G_\alpha^{\dif\tau \dif t}}{\partial \vn_\vy}
	(\vr, \delta) \right| 
	\leq \left| 
	\frac{\left(\frac{\| \vr \|^2}{2\alpha} - \delta \right)
	\erf\left(\frac{\| \vr \|}{2\sqrt{\alpha\delta}}  \right)
	+ \frac{\sqrt{\delta} \| \vr \|}{\sqrt{\pi\alpha}} 
	\exp \left( -\frac{\| \vr\|^2}{4\alpha \delta} \right)}
	{4 \pi \| \vr\|^2 }
	 \right| =: \big|\tilde g^{\dif \tau \dif t}(\|\vr \|, \delta)\big|
\end{equation*}
and observing that the limit of the function $\tilde g^{\dif \tau \dif t}$ for $\rho = \| \vr\| \rightarrow 0_+$ is zero. Indeed, L'Hospital's rule yields
\begin{align*}
	\lim_{\rho \rightarrow 0_+} \tilde g^{\dif \tau \dif t}(\rho,\delta) &=
	\lim_{\rho \rightarrow 0_+} \frac{
	\left(\frac{\rho^2}{2\alpha}-\delta \right) \erf\left(\frac{\rho}{2\sqrt{\alpha\delta}} \right)
	+ \frac{\sqrt{\delta} \rho}{\sqrt{\pi\alpha}} \exp \left( -\frac{\rho^2}{4 \alpha\delta} \right)}
	{4\pi \rho^2} \\ &= 
	\lim_{\rho \rightarrow 0_+} \frac{ \frac{\rho}{\alpha} \erf\left(\frac{\rho}{2\sqrt{\alpha\delta}}\right)
	+\exp\left(-\frac{\rho^2}{4\alpha\delta}\right) 
	\left( \frac{1}{\sqrt{\pi \alpha\delta}} \left(\left( \frac{\rho^2}{2\alpha} - \delta \right)
	+ \left( \delta - \frac{\rho^2}{2\alpha}\right) \right) \right)}
	{8 \pi \rho} \\
	&= \lim_{\rho \rightarrow 0_+}\frac{1}{8 \pi \alpha} \bigg( \erf\bigg( \frac{\rho}{2\sqrt{\alpha\delta}} \bigg) + \frac{\rho}{\sqrt{\pi\alpha\delta}} \exp\bigg(-\frac{\rho^2}{4\alpha\delta}\bigg)\bigg)  = 0.
\end{align*}

For $K^0(\vr)$ we can write
\begin{align*}
  K^0(\vr) &= \alpha\frac{\partial}{\partial \vn_\vy} \int_{0}^{h_t} G^{\dif \tau}_\alpha(\vr,0) - G^{\dif \tau}_\alpha(\vr, t) \,\dif t 
  = \alpha \bigg( \frac{\partial G^{\dif\tau}_\alpha}{\partial \vn_\vy} (\vr,0) - \frac{\partial G^{\dif\tau\dif t}_\alpha}{\partial \vn_\vy}(\vr,h_t) + \frac{\partial G^{\dif\tau\dif t}_1}{\partial \vn_\vy}(\vr,0) \bigg).
\end{align*}
Similarly as in \eqref{eq:dn_G_dt_dtau} with \eqref{eq:G_to_g} we have
\begin{equation*}
  \frac{\partial G^{\dif\tau}_\alpha}{\partial \vn_\vy}(\vr,\delta) = -\frac{\partial g^{\dif\tau}}{\partial \rho}(\|\vr\|,\delta) \frac{\vr \cdot \vn_\vy}{\|\vr\|}
\end{equation*}
with $G^{\dif\tau}_\alpha(\vr,\delta) =: g^{\dif\tau}(\|\vr\|,\delta)$ and 
\begin{equation*}
  \frac{\partial g^{\dif\tau}}{\partial \rho}(\|\vr\|,\delta) = -\frac{1}{4\pi} \frac{1}{|\vr\|}\bigg[ \frac{1}{\alpha\|\vr\|} \erf\bigg( \frac{\|\vr\|}{2\sqrt{\alpha\delta}} \bigg) - \frac{1}{\sqrt{\pi\alpha^3\delta}} \exp\bigg( -\frac{\|\vr\|^2}{4\alpha\delta} \bigg) \bigg].
\end{equation*}
We thus finally obtain
\begin{equation}
\label{eq:dn_G_dtau}
  \alpha \frac{\partial G^{\dif\tau}_\alpha}{\partial \vn_\vy}(\vr,\delta) = \frac{1}{4\pi} \frac{\vr \cdot \vn_\vy}{\|\vr\|^2}\bigg[ \frac{1}{\|\vr\|} \erf\bigg( \frac{\|\vr\|}{2\sqrt{\alpha\delta}} \bigg) - \frac{1}{\sqrt{\pi\alpha\delta}} \exp\bigg( -\frac{\|\vr\|^2}{4\alpha\delta} \bigg) \bigg].
\end{equation}
For $\|\vr\| > 0$ it holds
\begin{equation}
\label{eq:dn_G_dtau_lim_r}
  \lim_{\delta \to 0_+} \alpha\frac{\partial G^{\dif\tau}_\alpha}{\partial \vn_\vy}(\vr,\delta) = \frac{ \vr \cdot \vn_\vy}{4\pi\|\vr\|^3}.
\end{equation}
For $\delta > 0$ we again have
\begin{equation*}
  \lim_{\|\vr\| \to 0_+}\alp \frac{\partial G^{\dif\tau}_\alpha}{\partial \vn_\vy}(\vr,\delta) = 0.
\end{equation*}

The layout of the block matrix $\matK_h$ is the same as in \eqref{eq:V_mat}. The individual blocks in $\matK_h$ are set up as
\begin{equation*}
  \matK^d_h[ \ell , j ] = \int_{\gamma_\ell} \int_{\partial\Omega} \varphi^1_{\vx,j}(\vy) K^d(\vx-\vy) \,\dif\vs_\vy \,\dif\vs_\vx.
\end{equation*}

\subsection{Hypersingular operator}

Plugging the approximation
\begin{equation*}
 u \approx u_h := \sum_{k=1}^{E_t N_\vx} u_k \varphi^{0,1}_{t\vx,k} = \sum_{i=1}^{E_t} \sum_{j=1}^{N_\vx} u_{i,j} \varphi^0_{t,i} \varphi^1_{\vx,j}
\end{equation*}
into \eqref{eq:D_bil} and testing with
\begin{equation*}
  r := \varphi^0_{t,k} \varphi^1_{\vx,\ell}
\end{equation*}
we obtain for $d=k-i$ that
\begin{align*}
  &\langle Du_h, r \rangle_\Sigma = \\ 
  &\sum_{i=1}^{k-1} \sum_{j=1}^{N_\vx} u_{i,j}\int_{\partial\Omega} \int_{\partial\Omega} \curl_{\partial\Omega} \varphi^1_{\vx,\ell}(\vx) \cdot \curl_{\partial\Omega} \varphi^1_{\vx,j}(\vy) \alpha^2 \int_{t_{d}}^{t_{d+1}} \int_{0}^{t_1} G_\alpha(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx \\
    &+\sum_{j=1}^{N_\vx} u_{k,j}\int_{\partial\Omega} \int_{\partial\Omega} \curl_{\partial\Omega} \varphi^1_{\vx,\ell}(\vx) \cdot \curl_{\partial\Omega} \varphi^1_{\vx,j}(\vy) \alpha^2 \int_{0}^{t_1} \int_{0}^{t} G_\alpha(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx \\
  &- \sum_{i=1}^{k-1} \sum_{j=1}^{N_\vx} u_{i,j} \int_{\partial\Omega} \int_{\partial\Omega} \vn(\vx) \cdot \vn(\vy) \varphi^1_{\vx,\ell}(\vx) \varphi^1_{\vx,j}(\vy) \alpha \int_{t_d}^{t_{d+1}} \int_0^{t_1} \frac{\partial G_\alpha}{\partial \tau}(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx \\
    &- \sum_{j=1}^{N_\vx} u_{k,j} \int_{\partial\Omega} \int_{\partial\Omega} \vn(\vx) \cdot \vn(\vy) \varphi^1_{\vx,\ell}(\vx) \varphi^1_{\vx,j}(\vy) \alpha \int_{t_d}^{t_{d+1}} \int_0^{t} \frac{\partial G_\alpha}{\partial \tau}(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx.
\end{align*}
Since the surface curls of spatially piecewise linear functions are piecewise constant, we can rewrite one of the summands in the first part as
\begin{align*}
  \matD^{1,d}_h[\ell,j] &:= \int_{\partial\Omega} \int_{\partial\Omega}\curl_{\partial\Omega} \varphi^1_{\vx,\ell}(\vx) \cdot \curl_{\partial\Omega} \varphi^1_{\vx,j}(\vy) \alpha^2 \int_{t_{d}}^{t_{d+1}} \int_{0}^{t_1} G_\alpha(\vx-\vy,t-\tau) \,\dif\tau \,\dif t \,\dif\vs_\vy \,\dif\vs_\vx \\
  &= \sum_{\gamma_n \subset \supp \varphi^1_{\vx,\ell}} \sum_{\gamma_m \subset \supp \varphi^1_{\vx,j}} \curl_{\partial\Omega} \varphi^1_{\vx,\ell}|_{\gamma_n}(\vx) \cdot \curl_{\partial\Omega} \varphi^1_{\vx,j}|_{\gamma_m}(\vy) \alpha^2 \matV_h^d[n,m].
\end{align*}
Thus, for all $d \in \{0,\ldots,E_t-1\}$ the matrix $\matD_h^{1,d}$ is a sparse transformation of the single-layer block $\matV^d_h$ from \eqref{eq:V_blocks}. In particular,
\begin{equation*}
  \matD_h^{1,d} = \matT^\top 
  \begin{bmatrix}
    \alpha^2\matV^d_h & \matO & \matO \\
    \matO & \alpha^2\matV^d_h & \matO \\
    \matO & \matO & \alpha^2\matV^d_h
  \end{bmatrix}
  \matT,\quad
  \matT :=
  \begin{bmatrix}
    \matT_1 \\
    \matT_2 \\
    \matT_3
  \end{bmatrix},\quad
  \matT_o[m,j] := [\curl_{\partial\Omega} \varphi^1_{\vx,j}|_{\gamma_m}]_o.
\end{equation*}

For the second part we have to analytically evaluate the integrals
\begin{equation*}
  D^{2,d}(\vr) := 
  \begin{cases}
  \displaystyle
    -\alpha \int_{0}^{h_t} \int_{0}^{t} \frac{\partial G_\alpha}{\partial \tau}(\vr,t-\tau) \,\dif\tau \,\dif t & \text{for } d = 0, \\[4mm]
  \displaystyle
    -\alpha \int_{dh_t}^{(d+1)h_t} \int_{0}^{h_t} \frac{\partial G_\alpha}{\partial \tau}(\vr,t-\tau) \,\dif\tau \,\dif t & \text{for } d \in \{1,\ldots,E_t-1\}.
  \end{cases}
\end{equation*}
For $d>0$ we can write
\begin{align*}
  D^{2,d}(\vr) &= -\alpha \int_{dh_t}^{(d+1)h_t} G_\alpha(\vr,t-h_t) - G_\alpha(\vr,t) \,\dif t \\
  &= -\alpha \big[ 2 G_\alpha^{\dif t}( \vr, dh_t ) - G_\alpha^{\dif t}(\vr, (d + 1)h_t) - G_\alpha^{\dif t}(\vr, (d - 1)h_t ) \big]
\end{align*}
with $G_\alpha^{\dif t} = -G_\alpha^{\dif \tau}$ from \eqref{eq:G_dtau}. In addition to the limiting case \eqref{eq:G_dtau_lim_d} we have to treat the limit for $\delta>0$,
\begin{equation*}
  \lim_{\|\vr\| \to 0_+} G^{\dif t}_\alpha(\vr,\delta) = -\frac{1}{4\pi\alpha\sqrt{\pi\alpha\delta}}.
\end{equation*}

For $d=0$ we have
\begin{equation*}
  D^{2,0}(\vr) = -\alpha \int_0^{h_t} G_\alpha(\vr,0) - G_\alpha(\vr, t) \,\dif t.
\end{equation*}
Since $G_\alpha(\vr,0) = 0$ for any $\vr$ with $\| \vr\|>0$ it holds
\begin{equation*}
  D^{2,0}(\vr) = -\alpha ( G_\alpha^{\dif t}( \vr, 0 ) - G_\alpha^{\dif t}(\vr, h_t ) ).
\end{equation*}
Finally, $\matD_h = \matD_h^1 + \matD_h^2$ possesses the same layout as \eqref{eq:V_mat}. The individual blocks in $\matD_h^2$ are set up as
\begin{equation*}
  \matD^{2,d}_h[ \ell , j ] = \int_{\partial\Omega} \int_{\partial\Omega} \vn(\vx) \cdot \vn(\vy) \varphi^1_{\vx,\ell}(\vx) \varphi^1_{\vx,j}(\vy) D^{2,d}(\vx-\vy) \,\dif\vs_\vy \,\dif\vs_\vx.
\end{equation*}

\subsection{Single-layer potential}

To evaluate the discretized representation formula in $\vx\in\Omega$ and the temporal nodes $t_k = k h_t$ we have to compute the contribution of the single-layer potential
\begin{align*}
 Vw_h(\vx, t_k) &= \sum_{i=1}^{k} \sum_{j=1}^{E_\vx} w_{i,j} \int_{\gamma_j} \int_{t_{i-1}}^{t_i} G_\alpha(\vx-\vy,t_k-\tau) \,\dif\tau \,\dif\vs_\vy \\
 &= \sum_{d=0}^{k-1} \sum_{j=1}^{E_\vx} w_{i,j} \int_{\gamma_j} \int_{0}^{h_t} G_\alpha(\vx-\vy,(d+1)h_t-\tau) \,\dif\tau \,\dif\vs_\vy \\
  &= \sum_{j=1}^{E_\vx} \int_{\gamma_j} \sum_{d=0}^{k-1} w_{i,j} [ G_\alpha^{\dif\tau}(\vx-\vy, dh_t) - G_\alpha^{\dif\tau}(\vx-\vy, (d+1)h_t) ] \,\dif\vs_\vy
\end{align*}
with $G_1^{\dif\tau}$ from \eqref{eq:G_dtau} and its limit for $\delta \to 0_+$ in \eqref{eq:G_dtau_lim_d}. Note that as in the case of matrix assembly, one can reuse the analytic evaluations for all combinations of $k,i$ such that $k-i=d$ is constant.

\subsection{Double-layer potential}

For the double-layer potential we similarly obtain
\begin{align*}
  Ku_h(\vx, t_k) &= \sum_{i=1}^{k} \sum_{j=1}^{N_\vx} u_{i,j} \int_{\partial\Omega} \varphi^1_{\vx,j}(\vy) \int_{t_{i-1}}^{t_i} \alpha \frac{\partial G_\alpha}{\partial \vn_\vy}(\vx-\vy,t_k-\tau) \,\dif\tau \,\dif\vs_\vy \\
  &= \sum_{j=1}^{N_\vx} \int_{\partial\Omega} \varphi^1_{\vx,j}(\vy) \sum_{d=0}^{k-1} u_{i,j} \alpha \bigg[ \frac{\partial G_\alpha^{\dif\tau}}{\partial \vn_\vy}(\vr, dh_t) - \frac{\partial G_\alpha^{\dif\tau}}{\partial \vn_\vy}(\vr, (d+1)h_t) \bigg] \,\dif\vs_\vy
\end{align*}
with $\alpha\partial G_\alpha^{\dif\tau} / \partial \vn_\vy$ from \eqref{eq:dn_G_dtau} and its limit for $\delta \to 0_+$ in \eqref{eq:dn_G_dtau_lim_r}.

\newpage
\bibliographystyle{acm}
\bibliography{references}

\end{document}














